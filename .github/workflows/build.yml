name: Build Cubyz Workflow

run-name: Build Cubyz

on:
  push:
    branches: [ "master", "actions" ]

jobs:
  Build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - run: ./ci-mac.sh
        name: Run build script
      # todo: get Cubyz from cache
      # todo: cache zig
      # todo: cache compiler_rt, zig-cache, zig-out
      # todo: split packaging into a separate github artifact/workflow
      - run: file ./zig-out/bin/Cubyzig
      # todo: download a libGL that I upload elsewhere
      # todo: Cubyz-app: change ~ to some root path
      # move out to exit Cubyz dir
      - run: cd ..
      - uses: actions/checkout@v4
        with:
          ref: "main"
          repository: "Archbirdplus/Cubyz-app"
      # checkout now sends "us" to Cubyz-app
      - run: ./all.sh
      # todo: github-release the app
      
